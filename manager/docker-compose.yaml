services:
  manager:
    build: .
    container_name: ctf_manager
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      # Mount Docker socket so the manager can call `docker compose` on the host
      - /var/run/docker.sock:/var/run/docker.sock
      # Persist the SQLite database across container restarts
      - ./data:/app/data
      # Mount the CTF compose file into the container at a fixed path.
      # CTF_COMPOSE_FILE must point to this *container* path (see note below).
      - ../challenge/docker-compose.yaml:/ctf/challenge/docker-compose.yaml:ro
    environment:
      # --- REQUIRED: change these before running ---
      SECRET_KEY:        "change-me-to-a-random-string"
      ADMIN_TOKEN:       "change-me-to-a-secret-token"

      # Path to the compose file as seen INSIDE the manager container.
      # The file is bind-mounted from ../challenge/docker-compose.yaml (see volumes above).
      # Do not change this unless you change the volume mount target too.
      CTF_COMPOSE_FILE:  "/ctf/challenge/docker-compose.yaml"

      # Absolute path to the challenge/ directory on the HOST machine.
      # Used as --project-directory so the Docker daemon resolves relative bind mounts
      # (e.g. ./web/src) against the real host filesystem, not the container filesystem.
      #
      # Example: if you cloned the repo to /home/user/bankingai-ctf on the host, set:
      #   CHALLENGE_DIR: /home/user/bankingai-ctf/challenge
      CHALLENGE_DIR:     "/home/user/bankingai-ctf/challenge"

      # IP or hostname teams will use to reach their instance.
      # Use a LAN IP, public hostname, or 127.0.0.1 for local testing.
      HOST_IP:           "192.168.1.10"

      # First port in the range assigned to team instances (inclusive).
      PORT_RANGE_START:  "8000"

      # Secret used to derive per-team flags.
      # Flags are generated as CTF{<slug>_<hmac(FLAG_SECRET, flag_id:team_name)[:8]>}
      # e.g. CTF{login_3a7f9c21} â€” unique per team, no manual sync needed.
      # Change this before running; do not share it with players.
      FLAG_SECRET:               "change-me-flag-secret"
